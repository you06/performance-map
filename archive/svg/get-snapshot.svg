<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="741px" height="351px" viewBox="-0.5 -0.5 741 351" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2022-05-30T08:22:35.994Z&quot; agent=&quot;5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/18.1.3 Chrome/100.0.4896.143 Electron/18.2.3 Safari/537.36&quot; etag=&quot;VFIP8sc2lJeR6ft68AAE&quot; version=&quot;18.1.3&quot; type=&quot;device&quot; pages=&quot;3&quot;&gt;&lt;diagram id=&quot;KeO0y7A_8oGp1gHYRd_c&quot; name=&quot;point get&quot;&gt;3Vddb9owFP01SO0DU4iBsscCbfehaVNRt8fJxDeJh7FT2ym0v3527JCEAEUTbdUBAuf42r4+595r00GT5fpG4iz9JgiwThiQdQdNO2HY64dhx34C8uiQ0QVyQCIp8UYVMKNP4MHAozkloBqGWgimadYEI8E5RLqBYSnFqmkWC9ZcNcMJtIBZhFkb/UWJTv0uwosK/wQ0ScuVe8OPrmeJS2O/E5ViIlY1CF110EQKoV1ruZ4As+SVvLhx13t6N45J4PqYAQg+499f7oY3l3TWp91cT9NZ18/ygFnuN+yd1Y8lA1LknICdJOig8SqlGmYZjmzvymhusFQvmXnqmWbbqXIFkBrWNcg7eQNiCVo+GhPfW/LlAyYc+OdVRX9/6LG0Rn3fY9grnmxmrkgxDc9L8XinQH6f/7FxEwYMz4H5obc/jOmQmZnHc2laiW1JiIA+gDGVcJ+D0m69g/yGta16Pf6V2pgyNhFMyGIsigf2bXHBdQ13L4MrLcUCaj3D4vVqIvWC04hkHms6HdYNLKA4zlQqvDyM8kUZ2cgYdJvdB9VDL6YeGcCI9HepNArn6FQq9Y6Q6eOLqXRcBervqEAu81SGeYPx4X1ui+U4cmxd2kxM5mcDQ4JZP6h+zwv6AsOS7mJGE+6MI8MkyKKvnKrMbZfxQTvFi4E6tRDJJdZUcHfaaEy5Mk0OeiXkwrLFSb02WOkU5YlzCnT0oV1S2shWCBfLUx6xnBRTBRLHWmkhrUMMMDH7KdyJqVyW3jlHzEzajbkV0UJNx43UeN4TBWB3tZImrp0fHnFsODwMJtfmS8Qb/OvPxopa2FOXFh41BxquhSTHc+IjpCCkWs6hBlLuZmC+5zQpF54XXdzUACBFa68XE8dYa95YimUVARDjnGm/6yMcd1GlwEeGygRXsEPUssfaSmpC9qmp5SbI9q1p0s+lSwlvHeI2FZoFqVl4uOCwVaU85PNnyiC2M9jiQ8316NLDWmR7il+zPJ7+zEGoXcwu+juqWYhOdzNoJMXzB0gv6LzvE2RzD3+TE+TwOe9TdDslzkRmcwez82ME6r1zgVDwvECj1xdo5wV6uw4eIc//en9Goze9QBuo+uNZmNf+vqOrvw==&lt;/diagram&gt;&lt;diagram id=&quot;MXwPVq-dtZGEBMUVvnZR&quot; name=&quot;batch get&quot;&gt;3Vhtb9s2EP41BtoPKWTJb/kY22k7rEWLBtu6fSlo8WSxpkmVpGO7v35HkbJEyW8bkqGdE9jkw+Px+NzxjlIvma13bxQp8veSAu/FEd31knkvjvuDOO7Z/4juHTIZJw5YKka9UA08sO/gwcijG0ZBB4JGSm5YEYKpFAJSE2BEKbkNxTLJw1ULsoQO8JAS3kX/YNTkfhfxuMbfAlvm1cr90a0bWZNK2O9E54TKbQNK7nvJTElpXGu9mwG35FW8uHmvT4weDFMgzDUTVu/79PbL/K3Zfnj8Sz2u9C9fFjdeyyPhG79hb6zZVwwouREUrJKol0y3OTPwUJDUjm7R54jlZs2x18dm16hqBVAGdg3IG/kG5BqM2qOIH6348gETD31/W9M/GHksb1A/8BjxHl8eNNekYMPzUnZ/06A+LL7auIkjThbA/dRPH1F0xFHzdKGwtbQtBSmwR0BRBd82oI1b7yy/cWOr3h//ltqMcT6TXKpybpIN7Z/FpTAN3H0Q10bJFTRGRuXnP3NSP3oaJ2G34afzfgMLaEEKnUvvHs7EqorsBAVuwuGz3kuezXt0CBM6OOalSbxInspL/SvcdPtsXrouAw2OZCB38nRBRMD46NvGJstp6ti6sydxuXgxRBJw/aj+fVnSFyFL5oZwthROOEUmQZVjlarqbLsTH3WPeDnR5BaiG0UMk8JVG0OY0NgUYLZSrSxbgjZzg3WdZmLpjAKTvuqmlC7SCuFyeSZSvqGlqkiRzGgjlTWIA6G4n9KcjKl1ZZ0zBDUZN+eTTFd6Pg2OxmVLNIDd1VZhXDs7POLYcHgczV7jl8wO+K+/BysaaasuKy0KJyLXUtHrOfERUhJSL+dQhLS7GeD3gi2rhRflkMAcALRsnbRi5hjr6M2UXNcRABnZcON3fYXhLqo0+MjQhRQajji1GrGyimHIfg99eQiyU2vi8XPHpYJbRdwehTAhhYlHSAGtLOUhf37mHDKrwSYfhtejOw8bWZxIfmF6fPqakwy6yWw8OJLN4uS5bwZtB1+uLOP/6b0gmfyQF4Mgl132zvAnr/uHp6cfuO73B50kBRQfvXxXKpPLpRSE39doK6fUMu+kTUMl4V+x7O39cyTZYBUI3AE7Zj432n822vOd11t29lVHIAGfm53DHNupJ5W9atZJJ2q5USmc4WXk5AxRthxdiFG8V9Dg+bUbEgo41pLH8HH2mIPLqXdKkX1DoJBMGN3Q/NECp8970n4Ibcm3I7Mljw1nQR1qh60ci74rQ23YuWMqKIAYeyk4EoPvXOJoxk1VBQ9XyHYdXDNKXYiCxuq9KPXZSPAMovLhtDecH42Nswekc+wPLzv8Kr3m+4Rj6SB6FUe3w4D3G/8W5p9FR9edSah1HCqQWabBdLLHWZeef7bz17J2AX4hC3tfIvzlFdl99JNn9yS6nN0nz5bdEarfWTl31m/+kvu/AQ==&lt;/diagram&gt;&lt;diagram id=&quot;3N99doZ2_8Hj9dzwLi7w&quot; name=&quot;get snapshot&quot;&gt;3VhNc5swEP01zLSHdDDY2D7GdpLm0ElST6ZnGS2gRiAi5Nrpr+8KJBuMP5IO8bRxMoN4u2hX760W2Y4/Tdc3kuTJN0GBO55L144/czyv1/c8R/+79KVCRkO/AmLJqHHaAnP2GwzoGnTJKBQNRyUEVyxvgqHIMghVAyNSilXTLRK8GTUnMbSAeUh4G/3BqErMKrzhFv8KLE5s5F4wriwpsc5mJUVCqFjVIP/K8adSCFWN0vUUuCbP8lI9d33AuklMQqZe88Dd/dMDPJJhMr8f316LeX/6MLwws/wifGkWbJJVL5YBKZYZBT2J6/iTVcIUzHMSausKNUcsUSnHux4O20nZCCAVrGuQSfIGRApKvqCLtVrpTcV4A3O/2vLfcw2W1LjvG4wYyePN1FtWcGCIeQNJ/T0kBRyjToqcZA22guel1nMSCi6k41+iUcaLTwNcMsZ2t9fPJVkucqIuCGdxVjmHyBvI0manwlGsr7cR2jkQivZyUIBOvKgywwWUMzOl82FpzjWlMShtJxrLSF4kQpsjKVK8fBfhUzGbfLGLWUgbqo0cCQ7rnEmoh88AqA0r8RmNYwmt8bqASEioMlMsiztJLpciF2VCK4IJlESWI73fdb4q0UZJIlWoKrwSOipktJXi6XA7SzoQU2BQfc0BZGEjSihy0QqKi3SnZSEtdG7wvGSoqN5B5rFNDjaFUKRpGYsLTSFdSqKYyKwfVvnG9QiD6FYVsIV3dr4uzub2LpQUTzCtinuWiQw9JxHjfAcyFT3jEOkZ9OZn2FMvDaxEfqCVNJtNB93EazYTf9huJsP+nmbi+e/VTUatbmK3k9nGnauwaSq7OqSMUh3mPFL4u3190JIi2KPEuwkxPijEpqV9VCl2d0WvvStG55TCxv+XzyG+265Xb9zNOeSxAHm3+KkPsNjTyQJ49ejOm62c9jiR9TUZ5v+Ww3oZO55PBzCi/VbNo2XkLfwgOB/rHZGOtzXej+qw75X/CjG8/1wMzz0tRldH8TeoYc6G7YPNDaj55iR5Up7hu6kTDfSfxkWmanj12adaUH66es9+ZNV6wQeV7Zzfe/fIhtD2t4jSvfaLjn/1Bw==&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><rect x="90" y="0" width="100" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><rect x="0" y="120" width="740" height="230" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 738px; height: 1px; padding-top: 127px; margin-left: 2px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><span style="color: rgb(51, 51, 51); text-align: center;">If leader lease is valid, it simply gets a snapshot from RocksDB.<br /><br />If leader lease is expired, it needs a read index before getting a snapshot from RocksDB.<br /><br />propose wait: wait for the raftstore to send read index<br /><br />read index wait: wait for other peers to respond read index. Can be equivalent to <b>commit log duration</b>.<br /></span></div></div></div></foreignObject><text x="2" y="139" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">If leader lease is valid, it simply gets a snapshot from RocksDB....</text></switch></g><rect x="10" y="5" width="60" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 20px; margin-left: 11px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">lease valid</div></div></div></foreignObject><text x="40" y="24" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">lease valid</text></switch></g><rect x="0" y="60" width="80" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 75px; margin-left: 1px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">lease expired</div></div></div></foreignObject><text x="40" y="79" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">lease expired</text></switch></g><rect x="90" y="55" width="290" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><rect x="90" y="55" width="90" height="40" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 75px; margin-left: 91px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">propose wait</div></div></div></foreignObject><text x="135" y="79" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">propose wait</text></switch></g><rect x="180" y="55" width="100" height="40" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 75px; margin-left: 181px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">read index wait</div></div></div></foreignObject><text x="230" y="79" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">read index wait</text></switch></g><rect x="280" y="55" width="100" height="40" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 75px; margin-left: 281px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">RocksDB<br />GetSnapshot</div></div></div></foreignObject><text x="330" y="79" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">RocksDB...</text></switch></g><rect x="90" y="0" width="100" height="40" fill="#f5f5f5" stroke="#666666" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 20px; margin-left: 91px;"><div data-drawio-colors="color: #333333; " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">RocksDB<br />GetSnapshot</div></div></div></foreignObject><text x="140" y="24" fill="#333333" font-family="Helvetica" font-size="12px" text-anchor="middle">RocksDB...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>