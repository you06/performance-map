<!DOCTYPE html>
<!-- GENERATED BY: curl -sL https://cdn.jsdelivr.net/gh/zyguan/railroad-diagrams@perfmap/template.html | sed -e "s/^__TITLE__$/Performance Map/" -e "/^__MARKDOWN__$/{r $TARGET_MARKDOWN_FILE" -e "d}" > $OUTPUT_HTML_FILE -->
<head>
<title>
Performance Map
</title>
<link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/zyguan/railroad-diagrams@perfmap/railroad.css'/>
<style>
  body {
    background-color: hsl(30, 20%, 95%);
  }
  svg.railroad-diagram rect {
    fill: rgb(245, 245, 245);
  }
  svg.railroad-diagram g.with-metrics rect {
    fill: rgb(204, 255, 204);
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/zyguan/railroad-diagrams@perfmap/railroad.umd.js"></script>
</head>
<body>

<div id="CONTENT"></div>
<script id="MARKDOWN" type="text/plain">
# Performance Map

- [TiDB Query Duration](tidb-query-duration.html)
- [TiDB KV Client](tidb-kv-client.html)
- [TiKV](tikv.html)
</script>

<script>
  // export railroad defaults
  Object.entries(railroad.default).forEach(([k, v]) => globalThis[k] = v);

  // render markdown
  class Renderer extends marked.Renderer {
    constructor(options) {
      super(options);
      this.postActions = [];
    }
    code(text, lang, escaped) {
      if (lang != 'railroad') {
        return super.code(text, lang, escaped);
      } else {
        const id = `railroad-${window.crypto.getRandomValues(new Uint32Array(1))[0].toString(16)}`;
        this.postActions.push(function() {
          const src = document.createElement('script');
          src.innerHTML = `${text}.addTo(document.getElementById('${id}'))`;
          document.body.appendChild(src);
        });
        return `<div id=${id}></div>\n`;
      }
    }
  }

  marked.setOptions({ renderer: new Renderer() });
  document.getElementById('CONTENT').innerHTML = marked.parse(document.getElementById('MARKDOWN').innerText);
  marked.defaults.renderer.postActions.forEach(fn => fn());
</script>

</body>
